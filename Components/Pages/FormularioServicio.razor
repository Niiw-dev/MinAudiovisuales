@page "/formulario-servicio"
@using MinAudiovisual.Servicios.Application.DTOs
@using MinAudiovisual.Servicios.Application.UseCases.Servicios
@rendermode InteractiveServer
@inject CreateServicioUseCase CreateServicioUseCase

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
<link href="_content/MudBlazor/MudBlazor.min.css" rel="stylesheet" />
<script src="_framework/blazor.server.js"></script>
<script src="_content/MudBlazor/MudBlazor.min.js"></script>

<MudThemeProvider />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />

<MudContainer MaxWidth="MaxWidth.Medium" Class="my-4" Style="width:100%">

<!-- Subir Devocional -->
<MudPaper Elevation="4" Class="p-6 mb-6" Style="padding: 40px 30px; width:100%">
    <MudForm @ref="formUp" Model="@servicio">

        <MudText Typo="Typo.h5" Align="Align.Center" Class="mb-4">
            Formulario de Servicio
        </MudText>

        <MudGrid>
            <MudItem xs="12" md="12">
                <MudGrid>
                    <MudItem xs="12" md="6">
                        <MudSelect T="string" Label="Tipo de Servicio" @bind-Value="servicio.Tipo" Required="true" Placeholder="Seleccione el Servicio que hará">
                            <MudSelectItem Value="@("Oracion")">Oración</MudSelectItem>
                            <MudSelectItem Value="@("Culto")">Culto</MudSelectItem>
                            <MudSelectItem Value="@("Evento")">Evento</MudSelectItem>
                        </MudSelect>
                    </MudItem>
                    @if (servicio.Tipo == "Evento")
                    {
                        <MudItem xs="12" md="6">
                            <MudTextField Label="Nombre del Evento" @bind-Value="servicio.NombreEvento"/>
                        </MudItem>
                    }
                </MudGrid>
            </MudItem>
            
            <MudItem xs="12" md="6">
                <MudTextField Label="Nombre Responsable" @bind-Value="servicio.NombreResponsable"/>
            </MudItem>

            <MudItem xs="12" md="3">
                <MudDatePicker Label="Fecha" DateFormat="dd/MM/yyyy" @bind-Date="_fecha" />
            </MudItem>

            <MudItem xs="12" md="3">
                <MudTimePicker Label="Hora" TimeFormat="hh:mm" @bind-Time="_hora" />
            </MudItem>

            <MudItem xs="12">
                <MudTextField Label="Observaciones" @bind-Value="servicio.Observaciones" AutoGrow Lines="3"/>
            </MudItem>

            <MudItem xs="12">
                <MudTextField Label="¿Qué se puede mejorar?" @bind-Value="servicio.Mejoras" AutoGrow Lines="3"/>
            </MudItem>
        </MudGrid>

        @if (servicio.Tipo == "Culto")
        {
            <MudDivider Class="my-4" />
            <MudText Typo="Typo.h6">Detalle del Servicio</MudText>

            <MudGrid>
                <MudItem xs="12">
                    <MudTextField Label="Orden de Canciones" @bind-Value="servicio.Detalle.OrdenCanciones" AutoGrow Lines="3" />
                </MudItem>

                <MudItem xs="12">
                    <MudGrid>
                        <MudItem xs="12" md="2">
                            <MudCheckBox @bind-Value="servicio.Detalle.HayAnuncios" Label="¿Anuncios?" Color="Color.Primary" />
                        </MudItem>

                        @if (servicio.Detalle.HayAnuncios)
                        {
                            <MudItem xs="12" md="10">
                                <MudTextField Label="Detalles de Anuncios" @bind-Value="servicio.Detalle.Anuncios" AutoGrow Lines="1" />
                            </MudItem>
                        }
                    </MudGrid>
                </MudItem>
                
                <MudItem xs="12" md="6">
                    <MudTextField Label="Nombre de Prédica" @bind-Value="servicio.Detalle.Predica" />
                </MudItem>

                <MudItem xs="12" md="6">
                    <MudTextField Label="Canción de Ministración" @bind-Value="servicio.Detalle.CancionMinistracion" />
                </MudItem>

                <MudItem xs="12">
                    <MudGrid>
                        <MudItem xs="12" md="2">
                            <MudCheckBox @bind-Value="servicio.Detalle.HaySantaCena" Label="¿Santa Cena?" Color="Color.Primary" />
                        </MudItem>

                        @if (servicio.Detalle.HaySantaCena)
                        {
                            <MudItem xs="12" md="10">
                                <MudTextField Label="Canción para Santa Cena" @bind-Value="servicio.Detalle.CancionSantaCena" />
                            </MudItem>
                        }
                    </MudGrid>
                </MudItem>

                <MudItem xs="12">
                    <MudTextField Label="Observaciones Adicionales" @bind-Value="servicio.Detalle.ObservacionesAdicionales"
                                  AutoGrow Lines="3" />
                </MudItem>
            </MudGrid>
        }

        <MudItem xs="12" Class="text-center mt-4">
            <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="px-6" OnClick="GuardarServicio" ButtonType="ButtonType.Button">
                Guardar Servicio
            </MudButton>
        </MudItem>
    </MudForm>
</MudPaper>
</MudContainer>

@code {
    private MudForm? formUp;
    private DateTime? _fecha = DateTime.Today;
    private TimeSpan? _hora = DateTime.Now.TimeOfDay;
    private ServicioDto servicio = new();

    private async Task GuardarServicio()
    {
        servicio.FechaHora = _fecha.Value.Date + _hora.Value;
        
        await CreateServicioUseCase.ExecuteAsync(servicio);
        servicio = new();
    }
}
